using NUnit.Framework;
using System;
using SkiaSharp;

namespace Spectrogram.Tests
{
    class ColormapValues
    {
        [Test]
        public void Test_Colormap_ExtendedFractionsReturnEdgeValues()
        {
            var cmap = Colormap.Viridis;

            Random rand = new Random(0);
            for (double frac = -3; frac < 3; frac += rand.NextDouble() * .2)
            {
                Console.WriteLine($"{frac}: {cmap.GetRGB(frac)}");

                if (frac <= 0)
                    Assert.AreEqual(cmap.GetRGB(0), cmap.GetRGB(frac));

                if (frac >= 1)
                    Assert.AreEqual(cmap.GetRGB(1.0), cmap.GetRGB(frac));
            }
        }

        [Test]
        public void Test_Colormap_IntegerMatchesRGBColors()
        {
            var cmap = Colormap.Viridis;

            byte pixelIntensity = 123;
            var (r, g, b) = cmap.GetRGB(pixelIntensity);
            int int32 = cmap.GetInt32(pixelIntensity);

            SKColor color1 = new SKColor(r, g, b, 255);
            SKColor color2 = new SKColor((uint)int32);
            SKColor color3 = cmap.GetColor(pixelIntensity);

            Assert.AreEqual(color1, color2);
            Assert.AreEqual(color1, color3);
        }

        [Test]
        public void Test_colorLookup_integerMatchesTriplet()
        {
            for (int i = 0; i < 256; i++)
            {
                byte[] bytes = BitConverter.GetBytes(ints[i]);

                SKColor color1 = new SKColor(bytes[2], bytes[1], bytes[0]);

                SKColor color2 = new SKColor(rgb[i, 0], rgb[i, 1], rgb[i, 2]);

                Assert.AreEqual(color2.Red, color1.Red, 1);
                Assert.AreEqual(color2.Green, color1.Green, 1);
                Assert.AreEqual(color2.Blue, color1.Blue, 1);
            }
        }

        private readonly int[] ints =
        {
            04456788, 04457045, 04457303, 04523352, 04523610, 04524123, 04589916, 04590430,
            04590687, 04591201, 04656994, 04657507, 04657765, 04658278, 04658535, 04658793,
            04659306, 04725099, 04725356, 04725870, 04726127, 04726384, 04726897, 04727154,
            04727411, 04727668, 04662645, 04662902, 04663159, 04663416, 04663929, 04664186,
            04664443, 04599164, 04599676, 04599933, 04600190, 04534911, 04535423, 04535680,
            04535937, 04470657, 04471170, 04405891, 04406147, 04406404, 04341124, 04341381,
            04341893, 04276614, 04276870, 04211591, 04211847, 04146567, 04147080, 04081800,
            04082057, 04016777, 04017033, 04017289, 03952010, 03952266, 03887242, 03887498,
            03822219, 03822475, 03757195, 03757451, 03692171, 03692428, 03627148, 03627404,
            03562124, 03562380, 03497100, 03497356, 03432077, 03432333, 03367053, 03367309,
            03302029, 03302285, 03237005, 03237261, 03237517, 03172237, 03172493, 03107213,
            03107469, 03042190, 03042446, 03042702, 02977422, 02977678, 02912398, 02912654,
            02912910, 02847630, 02847886, 02782606, 02782862, 02783118, 02717838, 02718094,
            02652814, 02652814, 02653070, 02587790, 02588046, 02588302, 02523022, 02523278,
            02523534, 02458254, 02458509, 02393229, 02393485, 02393741, 02328461, 02328717,
            02328973, 02263437, 02263693, 02263949, 02198669, 02198924, 02199180, 02133900,
            02134156, 02134412, 02069132, 02069387, 02069643, 02069899, 02070155, 02004874,
            02005130, 02005386, 02005386, 02005641, 02005897, 02006153, 02006408, 02006664,
            02006920, 02007175, 02072967, 02073222, 02073478, 02139269, 02139525, 02205317,
            02205572, 02271108, 02336899, 02337154, 02402946, 02468737, 02534529, 02600320,
            02666111, 02731903, 02797694, 02863485, 02929021, 03060348, 03126139, 03191930,
            03323258, 03389049, 03520376, 03586167, 03717494, 03783030, 03914357, 04045684,
            04111475, 04242802, 04374129, 04505200, 04570991, 04702318, 04833645, 04964972,
            05096043, 05227369, 05358696, 05490023, 05621350, 05752421, 05883748, 06015074,
            06211937, 06343008, 06474335, 06605661, 06802524, 06933595, 07064921, 07196248,
            07392854, 07524181, 07655508, 07852114, 07983441, 08180303, 08311374, 08508236,
            08639307, 08836169, 08967495, 09164102, 09295428, 09492035, 09623361, 09819967,
            09951294, 10147900, 10344762, 10475832, 10672695, 10869301, 11000627, 11197234,
            11394096, 11525166, 11722028, 11918635, 12049705, 12246567, 12443174, 12574500,
            12771106, 12967713, 13099039, 13295646, 13492253, 13623580, 13820187, 13951258,
            14148121, 14344728, 14475800, 14672664, 14803736, 15000344, 15197209, 15328281,
            15524890, 15656219, 15852828, 15983902, 16180767, 16311841, 16442914, 16639780,

        };

        private readonly byte[,] rgb =
        {
            {68, 1, 84},
            {68, 2, 86},
            {69, 4, 87},
            {69, 5, 89},
            {70, 7, 90},
            {70, 8, 92},
            {70, 10, 93},
            {70, 11, 94},
            {71, 13, 96},
            {71, 14, 97},
            {71, 16, 99},
            {71, 17, 100},
            {71, 19, 101},
            {72, 20, 103},
            {72, 22, 104},
            {72, 23, 105},
            {72, 24, 106},
            {72, 26, 108},
            {72, 27, 109},
            {72, 28, 110},
            {72, 29, 111},
            {72, 31, 112},
            {72, 32, 113},
            {72, 33, 115},
            {72, 35, 116},
            {72, 36, 117},
            {72, 37, 118},
            {72, 38, 119},
            {72, 40, 120},
            {72, 41, 121},
            {71, 42, 122},
            {71, 44, 122},
            {71, 45, 123},
            {71, 46, 124},
            {71, 47, 125},
            {70, 48, 126},
            {70, 50, 126},
            {70, 51, 127},
            {70, 52, 128},
            {69, 53, 129},
            {69, 55, 129},
            {69, 56, 130},
            {68, 57, 131},
            {68, 58, 131},
            {68, 59, 132},
            {67, 61, 132},
            {67, 62, 133},
            {66, 63, 133},
            {66, 64, 134},
            {66, 65, 134},
            {65, 66, 135},
            {65, 68, 135},
            {64, 69, 136},
            {64, 70, 136},
            {63, 71, 136},
            {63, 72, 137},
            {62, 73, 137},
            {62, 74, 137},
            {62, 76, 138},
            {61, 77, 138},
            {61, 78, 138},
            {60, 79, 138},
            {60, 80, 139},
            {59, 81, 139},
            {59, 82, 139},
            {58, 83, 139},
            {58, 84, 140},
            {57, 85, 140},
            {57, 86, 140},
            {56, 88, 140},
            {56, 89, 140},
            {55, 90, 140},
            {55, 91, 141},
            {54, 92, 141},
            {54, 93, 141},
            {53, 94, 141},
            {53, 95, 141},
            {52, 96, 141},
            {52, 97, 141},
            {51, 98, 141},
            {51, 99, 141},
            {50, 100, 142},
            {50, 101, 142},
            {49, 102, 142},
            {49, 103, 142},
            {49, 104, 142},
            {48, 105, 142},
            {48, 106, 142},
            {47, 107, 142},
            {47, 108, 142},
            {46, 109, 142},
            {46, 110, 142},
            {46, 111, 142},
            {45, 112, 142},
            {45, 113, 142},
            {44, 113, 142},
            {44, 114, 142},
            {44, 115, 142},
            {43, 116, 142},
            {43, 117, 142},
            {42, 118, 142},
            {42, 119, 142},
            {42, 120, 142},
            {41, 121, 142},
            {41, 122, 142},
            {41, 123, 142},
            {40, 124, 142},
            {40, 125, 142},
            {39, 126, 142},
            {39, 127, 142},
            {39, 128, 142},
            {38, 129, 142},
            {38, 130, 142},
            {38, 130, 142},
            {37, 131, 142},
            {37, 132, 142},
            {37, 133, 142},
            {36, 134, 142},
            {36, 135, 142},
            {35, 136, 142},
            {35, 137, 142},
            {35, 138, 141},
            {34, 139, 141},
            {34, 140, 141},
            {34, 141, 141},
            {33, 142, 141},
            {33, 143, 141},
            {33, 144, 141},
            {33, 145, 140},
            {32, 146, 140},
            {32, 146, 140},
            {32, 147, 140},
            {31, 148, 140},
            {31, 149, 139},
            {31, 150, 139},
            {31, 151, 139},
            {31, 152, 139},
            {31, 153, 138},
            {31, 154, 138},
            {30, 155, 138},
            {30, 156, 137},
            {30, 157, 137},
            {31, 158, 137},
            {31, 159, 136},
            {31, 160, 136},
            {31, 161, 136},
            {31, 161, 135},
            {31, 162, 135},
            {32, 163, 134},
            {32, 164, 134},
            {33, 165, 133},
            {33, 166, 133},
            {34, 167, 133},
            {34, 168, 132},
            {35, 169, 131},
            {36, 170, 131},
            {37, 171, 130},
            {37, 172, 130},
            {38, 173, 129},
            {39, 173, 129},
            {40, 174, 128},
            {41, 175, 127},
            {42, 176, 127},
            {44, 177, 126},
            {45, 178, 125},
            {46, 179, 124},
            {47, 180, 124},
            {49, 181, 123},
            {50, 182, 122},
            {52, 182, 121},
            {53, 183, 121},
            {55, 184, 120},
            {56, 185, 119},
            {58, 186, 118},
            {59, 187, 117},
            {61, 188, 116},
            {63, 188, 115},
            {64, 189, 114},
            {66, 190, 113},
            {68, 191, 112},
            {70, 192, 111},
            {72, 193, 110},
            {74, 193, 109},
            {76, 194, 108},
            {78, 195, 107},
            {80, 196, 106},
            {82, 197, 105},
            {84, 197, 104},
            {86, 198, 103},
            {88, 199, 101},
            {90, 200, 100},
            {92, 200, 99},
            {94, 201, 98},
            {96, 202, 96},
            {99, 203, 95},
            {101, 203, 94},
            {103, 204, 92},
            {105, 205, 91},
            {108, 205, 90},
            {110, 206, 88},
            {112, 207, 87},
            {115, 208, 86},
            {117, 208, 84},
            {119, 209, 83},
            {122, 209, 81},
            {124, 210, 80},
            {127, 211, 78},
            {129, 211, 77},
            {132, 212, 75},
            {134, 213, 73},
            {137, 213, 72},
            {139, 214, 70},
            {142, 214, 69},
            {144, 215, 67},
            {147, 215, 65},
            {149, 216, 64},
            {152, 216, 62},
            {155, 217, 60},
            {157, 217, 59},
            {160, 218, 57},
            {162, 218, 55},
            {165, 219, 54},
            {168, 219, 52},
            {170, 220, 50},
            {173, 220, 48},
            {176, 221, 47},
            {178, 221, 45},
            {181, 222, 43},
            {184, 222, 41},
            {186, 222, 40},
            {189, 223, 38},
            {192, 223, 37},
            {194, 223, 35},
            {197, 224, 33},
            {200, 224, 32},
            {202, 225, 31},
            {205, 225, 29},
            {208, 225, 28},
            {210, 226, 27},
            {213, 226, 26},
            {216, 226, 25},
            {218, 227, 25},
            {221, 227, 24},
            {223, 227, 24},
            {226, 228, 24},
            {229, 228, 25},
            {231, 228, 25},
            {234, 229, 26},
            {236, 229, 27},
            {239, 229, 28},
            {241, 229, 29},
            {244, 230, 30},
            {246, 230, 32},
            {248, 230, 33},
            {251, 231, 35},
            {253, 231, 37},
        };
    }
}
